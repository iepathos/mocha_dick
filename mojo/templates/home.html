{% extends '../templates/base.html' %}

{% block title %}home{% end %}

{% block extra_head %}

{% end %}

{% block content %}
<div class="col-xs-offset-2 col-xs-7">
    <center>
        <h1>Clutch or Choke?</h1>

        <button class='btn btn-lg' id='clutch'>Clutch</button>
        <button class='btn btn-lg' id='choke'>Choke</button>
    </center>
</div>

<div class="col-xs-3">
    <div class="pull-right">
        O herro, {{ user }}!
    </div>
    <br>
    <div class="pull-right">
        wallet: <span id='wallet-funds' >{{ funds }}</span>
    </div>
    <br>
    <a href="/wallet/" class='pull-right'>add to wallet</a>
    <br>
    <a href="/logout/" class='pull-right'>logout</a> <br>
</div>
{% end %}


{% block extra_js %}
<script type='text/javascript'>
  $(document).ready(function(){ 
    if ("WebSocket" in window) {
      var ws = new WebSocket("ws://localhost:8888/datasync/");
      ws.onopen = function() {
        console.log('DataSync open');
      };
      ws.onmessage = function (evt) {
        
        var json = evt.data;
        msg = JSON.parse(json);
        // #wallet-funds
        if (msg['funds'] != null) {
          $('#wallet-funds').html(msg['funds']);
        }
      };
      ws.onclose = function() {};
    } else {
      alert("WebSocket not supported");
    }

    function getCookie(name) {
      var r = document.cookie.match("\\b" + name + "=([^;]*)\\b");
      return r ? r[1] : undefined;
    }

  });
</script>
{% end %}